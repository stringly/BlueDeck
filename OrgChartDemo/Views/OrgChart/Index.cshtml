@{ 
    ViewData["Title"] = "Index";
    Layout = "_OrgChartLayout";
}

    <div id="people"></div>
    <script type="text/javascript">
        var orgChart;
        $.getJSON("/OrgChart/GetComponents", function (source) {
            orgChart = new getOrgChart(document.getElementById("people"), {
                enableEdit: false,
                enableDetailsView: false,
                primaryFields: ["componentName", "positionName", "memberName", "email"],
                color: "blue",
                expandToLevel: 2,
                updatedEvent: function () {
                    init();
                },
                dataSource: source
            });
        });



        function getNodeByClickedBtn(el) {
            while (el.parentNode) {
                el = el.parentNode;
                if (el.getAttribute("data-node-id"))
                    return el;
            }
            return null;
        }
        function btnClicked(sender) {
            var nodeElement = getNodeByClickedBtn(sender);
            var action = sender.getAttribute("data-action");
            var id = nodeElement.getAttribute("data-node-id");
            var node = orgChart.nodes[id];
            var memberId = node.data["memberId"];
            var positionId = node.data["positionId"];
            switch (action) {
                case "member":
                    window.location.href = "/Members/Details?id=" + memberId;
                    break;
                case "component":
                    window.location.href = "/Positions/Details?id=" + positionId;
                    break;
            }
        }

        var init = function () {
            var btns = document.getElementsByClassName("btn btn-org");
            for (var i = 0; i < btns.length; i++) {

                btns[i].addEventListener("click", function () {
                    var nodeElement = getNodeByClickedBtn(this);
                    var action = this.getAttribute("data-action");
                    var id = nodeElement.getAttribute("data-node-id");
                    var node = orgChart.nodes[id];

                    switch (action) {
                        case "edit":
                            alert(id);
                            break;
                        case "preview":
                            orgChart.showDetailsView(id);
                            break;
                    }
                });
            }
        }
        init();

    </script>
